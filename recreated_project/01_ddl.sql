DROP TABLE db_project_example.TRANSACTIONS CASCADE CONSTRAINTS;

CREATE TABLE db_project_example.TRANSACTIONS (
    TRANSACTION_ID   NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    ENTITY_NAME      VARCHAR2(50), -- Name of the operated table
    OPERATION_TYPE   VARCHAR2(10), -- operation type (INSERT, UPDATE, DELETE)
    REFERENCE_ID     NUMBER,       -- ID in the referenced table
    OPERATION_DATE   TIMESTAMP DEFAULT SYSTIMESTAMP -- operation date
);

DROP TABLE db_project_example.USERS CASCADE CONSTRAINTS;

CREATE TABLE db_project_example.USERS
(
  USER_ID          INTEGER                      NOT NULL,
  USERNAME         VARCHAR2(50 CHAR)            NOT NULL,
  EMAIL            VARCHAR2(50 CHAR)            NOT NULL,
  PASSWORD_HASH    VARCHAR2(255 CHAR)           NOT NULL,
  PROFILE_PICTURE  VARCHAR2(255 CHAR)           NOT NULL,
  CREATED_AT       TIMESTAMP(0),
  IS_ADMIN         INTEGER                      NOT NULL
)
TABLESPACE USERS
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
LOGGING
NOCOMPRESS
NOCACHE;


CREATE UNIQUE INDEX db_project_example.USERS_PK ON db_project_example.USERS
(USER_ID)
LOGGING
TABLESPACE USERS
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

ALTER TABLE db_project_example.USERS ADD (
  CONSTRAINT USERS_PK
  PRIMARY KEY
  (USER_ID)
  USING INDEX db_project_example.USERS_PK
  ENABLE VALIDATE);



DROP TABLE db_project_example.CHANNELS CASCADE CONSTRAINTS;

CREATE TABLE db_project_example.CHANNELS
(
  CHANNEL_ID    INTEGER                         NOT NULL,
  CHANNEL_NAME  VARCHAR2(100 CHAR)              NOT NULL,
  DESCRIPTION   CLOB
)
LOB (DESCRIPTION) STORE AS SECUREFILE (
  TABLESPACE  USERS
  ENABLE      STORAGE IN ROW
  CHUNK       8192
  RETENTION
  NOCACHE
  LOGGING)
TABLESPACE USERS
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
LOGGING
NOCOMPRESS
NOCACHE;


CREATE UNIQUE INDEX db_project_example.CHANNELS_PK ON db_project_example.CHANNELS
(CHANNEL_ID)
LOGGING
TABLESPACE USERS
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

ALTER TABLE db_project_example.CHANNELS ADD (
  CONSTRAINT CHANNELS_PK
  PRIMARY KEY
  (CHANNEL_ID)
  USING INDEX db_project_example.CHANNELS_PK
  ENABLE VALIDATE);




DROP TABLE db_project_example.ENTRIES CASCADE CONSTRAINTS;

CREATE TABLE db_project_example.ENTRIES
(
  ENTRY_ID    INTEGER                           NOT NULL,
  TITLE       VARCHAR2(50 CHAR)                 NOT NULL,
  CONTENT     CLOB                              NOT NULL,
  USER_ID     INTEGER                           NOT NULL,
  CHANNEL_ID  INTEGER                           NOT NULL,
  CREATED_AT  TIMESTAMP(0),
  UPDATED_AT  TIMESTAMP(0)
)
LOB (CONTENT) STORE AS SECUREFILE (
  TABLESPACE  USERS
  ENABLE      STORAGE IN ROW
  CHUNK       8192
  RETENTION
  NOCACHE
  LOGGING)
TABLESPACE USERS
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
LOGGING
NOCOMPRESS
NOCACHE;


CREATE UNIQUE INDEX db_project_example.ENTRIES_PK ON db_project_example.ENTRIES
(ENTRY_ID)
LOGGING
TABLESPACE USERS
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

ALTER TABLE db_project_example.ENTRIES ADD (
  CONSTRAINT ENTRIES_PK
  PRIMARY KEY
  (ENTRY_ID)
  USING INDEX db_project_example.ENTRIES_PK
  ENABLE VALIDATE);


ALTER TABLE db_project_example.ENTRIES ADD (
  FOREIGN KEY (CHANNEL_ID)
  REFERENCES db_project_example.CHANNELS (CHANNEL_ID)
  ENABLE VALIDATE
,  FOREIGN KEY (USER_ID)
  REFERENCES db_project_example.USERS (USER_ID)
  ENABLE VALIDATE);



DROP TABLE db_project_example.COMMENTS CASCADE CONSTRAINTS;

CREATE TABLE db_project_example.COMMENTS
(
  COMMENT_ID  INTEGER                           NOT NULL,
  ENTRY_ID    INTEGER                           NOT NULL,
  USER_ID     INTEGER                           NOT NULL,
  CONTENT     CLOB,
  CREATED_AT  TIMESTAMP(0)
)
LOB (CONTENT) STORE AS SECUREFILE (
  TABLESPACE  USERS
  ENABLE      STORAGE IN ROW
  CHUNK       8192
  RETENTION
  NOCACHE
  LOGGING)
TABLESPACE USERS
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
LOGGING
NOCOMPRESS
NOCACHE;


CREATE UNIQUE INDEX db_project_example.COMMENTS_PK ON db_project_example.COMMENTS
(COMMENT_ID)
LOGGING
TABLESPACE USERS
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

ALTER TABLE db_project_example.COMMENTS ADD (
  CONSTRAINT COMMENTS_PK
  PRIMARY KEY
  (COMMENT_ID)
  USING INDEX db_project_example.COMMENTS_PK
  ENABLE VALIDATE);


ALTER TABLE db_project_example.COMMENTS ADD (
  FOREIGN KEY (ENTRY_ID)
  REFERENCES db_project_example.ENTRIES (ENTRY_ID)
  ENABLE VALIDATE
,  FOREIGN KEY (USER_ID)
  REFERENCES db_project_example.USERS (USER_ID)
  ENABLE VALIDATE);


DROP TABLE db_project_example.LIKES CASCADE CONSTRAINTS;

CREATE TABLE db_project_example.LIKES
(
  LIKE_ID     INTEGER,
  ENTRY_ID    INTEGER,
  COMMENT_ID  INTEGER,
  USER_ID     INTEGER,
  CREATED_AT  TIMESTAMP(0)
)
TABLESPACE USERS
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
LOGGING
NOCOMPRESS
NOCACHE;


CREATE UNIQUE INDEX db_project_example.LIKES_PK ON db_project_example.LIKES
(LIKE_ID)
LOGGING
TABLESPACE USERS
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

ALTER TABLE db_project_example.LIKES ADD (
  CONSTRAINT LIKES_PK
  PRIMARY KEY
  (LIKE_ID)
  USING INDEX db_project_example.LIKES_PK
  ENABLE VALIDATE);


ALTER TABLE db_project_example.LIKES ADD (
  FOREIGN KEY (ENTRY_ID)
  REFERENCES db_project_example.ENTRIES (ENTRY_ID)
  ENABLE VALIDATE
,  FOREIGN KEY (COMMENT_ID)
  REFERENCES db_project_example.COMMENTS (COMMENT_ID)
  ENABLE VALIDATE
,  FOREIGN KEY (USER_ID)
  REFERENCES db_project_example.USERS (USER_ID)
  ENABLE VALIDATE);


DROP TABLE db_project_example.REPORTS CASCADE CONSTRAINTS;

CREATE TABLE db_project_example.REPORTS
(
  REPORT_ID   INTEGER                           NOT NULL,
  USER_ID     INTEGER                           NOT NULL,
  ENTRY_ID    INTEGER                           NOT NULL,
  COMMENT_ID  INTEGER                           NOT NULL,
  REASON      CLOB,
  CREATED_AT  TIMESTAMP(0),
  STATUS      VARCHAR2(50 CHAR)
)
LOB (REASON) STORE AS SECUREFILE (
  TABLESPACE  USERS
  ENABLE      STORAGE IN ROW
  CHUNK       8192
  RETENTION
  NOCACHE
  LOGGING)
TABLESPACE USERS
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
LOGGING
NOCOMPRESS
NOCACHE;


CREATE UNIQUE INDEX db_project_example.REPORTS_PK ON db_project_example.REPORTS
(REPORT_ID)
LOGGING
TABLESPACE USERS
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

ALTER TABLE db_project_example.REPORTS ADD (
  CONSTRAINT REPORTS_PK
  PRIMARY KEY
  (REPORT_ID)
  USING INDEX db_project_example.REPORTS_PK
  ENABLE VALIDATE);


ALTER TABLE db_project_example.REPORTS ADD (
  FOREIGN KEY (USER_ID)
  REFERENCES db_project_example.USERS (USER_ID)
  ENABLE VALIDATE
,  FOREIGN KEY (ENTRY_ID)
  REFERENCES db_project_example.ENTRIES (ENTRY_ID)
  ENABLE VALIDATE
,  FOREIGN KEY (COMMENT_ID)
  REFERENCES db_project_example.COMMENTS (COMMENT_ID)
  ENABLE VALIDATE);



DROP TABLE db_project_example.SAVED_ENTRIES CASCADE CONSTRAINTS;

CREATE TABLE db_project_example.SAVED_ENTRIES
(
  SAVED_ID  INTEGER                             NOT NULL,
  USER_ID   INTEGER                             NOT NULL,
  ENTRY_ID  INTEGER                             NOT NULL,
  SAVED_AT  TIMESTAMP(0)
)
TABLESPACE USERS
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
LOGGING
NOCOMPRESS
NOCACHE;


CREATE UNIQUE INDEX db_project_example.SAVED_ENTRIES_PK ON db_project_example.SAVED_ENTRIES
(SAVED_ID)
LOGGING
TABLESPACE USERS
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

ALTER TABLE db_project_example.SAVED_ENTRIES ADD (
  CONSTRAINT SAVED_ENTRIES_PK
  PRIMARY KEY
  (SAVED_ID)
  USING INDEX db_project_example.SAVED_ENTRIES_PK
  ENABLE VALIDATE);


ALTER TABLE db_project_example.SAVED_ENTRIES ADD (
  FOREIGN KEY (USER_ID)
  REFERENCES db_project_example.USERS (USER_ID)
  ENABLE VALIDATE
,  FOREIGN KEY (ENTRY_ID)
  REFERENCES db_project_example.ENTRIES (ENTRY_ID)
  ENABLE VALIDATE);





DROP TABLE db_project_example.MESSAGES CASCADE CONSTRAINTS;

CREATE TABLE db_project_example.MESSAGES
(
  MESSAGE_ID   INTEGER                          NOT NULL,
  SENDER_ID    INTEGER                          NOT NULL,
  RECEIVER_ID  INTEGER                          NOT NULL,
  CONTENT      CLOB                             NOT NULL,
  SENT_AT      TIMESTAMP(0),
  IS_READ      INTEGER,
  IS_SENT      INTEGER,
  READED_AT    INTEGER
)
LOB (CONTENT) STORE AS SECUREFILE (
  TABLESPACE  USERS
  ENABLE      STORAGE IN ROW
  CHUNK       8192
  RETENTION
  NOCACHE
  LOGGING)
TABLESPACE USERS
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
LOGGING
NOCOMPRESS
NOCACHE;


CREATE UNIQUE INDEX db_project_example.MESSAGES_PK ON db_project_example.MESSAGES
(MESSAGE_ID)
LOGGING
TABLESPACE USERS
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

ALTER TABLE db_project_example.MESSAGES ADD (
  CONSTRAINT MESSAGES_PK
  PRIMARY KEY
  (MESSAGE_ID)
  USING INDEX db_project_example.MESSAGES_PK
  ENABLE VALIDATE);


ALTER TABLE db_project_example.MESSAGES ADD (
  FOREIGN KEY (SENDER_ID)
  REFERENCES db_project_example.USERS (USER_ID)
  ENABLE VALIDATE
,  FOREIGN KEY (RECEIVER_ID)
  REFERENCES db_project_example.USERS (USER_ID)
  ENABLE VALIDATE);
