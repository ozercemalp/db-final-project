DROP TABLE TRANSACTIONS CASCADE CONSTRAINTS;

CREATE TABLE TRANSACTIONS (
    TRANSACTION_ID   NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    ENTITY_NAME      VARCHAR2(50), -- Name of the operated table
    OPERATION_TYPE   VARCHAR2(10), -- operation type (INSERT, UPDATE, DELETE)
    REFERENCE_ID     NUMBER,       -- ID in the referenced table
    OPERATION_DATE   TIMESTAMP DEFAULT SYSTIMESTAMP -- operation date
);

DROP TABLE USERS CASCADE CONSTRAINTS;

CREATE TABLE USERS
(
  USER_ID          INTEGER                      NOT NULL,
  USERNAME         VARCHAR2(50 CHAR)            NOT NULL,
  EMAIL            VARCHAR2(50 CHAR)            NOT NULL,
  PASSWORD_HASH    VARCHAR2(255 CHAR)           NOT NULL,
  PROFILE_PICTURE  VARCHAR2(255 CHAR)           NOT NULL,
  CREATED_AT       TIMESTAMP(0),
  IS_ADMIN         INTEGER                      NOT NULL
)
TABLESPACE USERS
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
LOGGING
NOCOMPRESS
NOCACHE;


CREATE UNIQUE INDEX USERS_PK ON USERS
(USER_ID)
LOGGING
TABLESPACE USERS
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

ALTER TABLE USERS ADD (
  CONSTRAINT USERS_PK
  PRIMARY KEY
  (USER_ID)
  USING INDEX USERS_PK
  ENABLE VALIDATE);



DROP TABLE CHANNELS CASCADE CONSTRAINTS;

CREATE TABLE CHANNELS
(
  CHANNEL_ID    INTEGER                         NOT NULL,
  CHANNEL_NAME  VARCHAR2(100 CHAR)              NOT NULL,
  DESCRIPTION   CLOB
)
LOB (DESCRIPTION) STORE AS SECUREFILE (
  TABLESPACE  USERS
  ENABLE      STORAGE IN ROW
  CHUNK       8192
  RETENTION
  NOCACHE
  LOGGING)
TABLESPACE USERS
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
LOGGING
NOCOMPRESS
NOCACHE;


CREATE UNIQUE INDEX CHANNELS_PK ON CHANNELS
(CHANNEL_ID)
LOGGING
TABLESPACE USERS
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

ALTER TABLE CHANNELS ADD (
  CONSTRAINT CHANNELS_PK
  PRIMARY KEY
  (CHANNEL_ID)
  USING INDEX CHANNELS_PK
  ENABLE VALIDATE);




DROP TABLE ENTRIES CASCADE CONSTRAINTS;

CREATE TABLE ENTRIES
(
  ENTRY_ID    INTEGER                           NOT NULL,
  TITLE       VARCHAR2(50 CHAR)                 NOT NULL,
  CONTENT     CLOB                              NOT NULL,
  USER_ID     INTEGER                           NOT NULL,
  CHANNEL_ID  INTEGER                           NOT NULL,
  CREATED_AT  TIMESTAMP(0),
  UPDATED_AT  TIMESTAMP(0)
)
LOB (CONTENT) STORE AS SECUREFILE (
  TABLESPACE  USERS
  ENABLE      STORAGE IN ROW
  CHUNK       8192
  RETENTION
  NOCACHE
  LOGGING)
TABLESPACE USERS
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
LOGGING
NOCOMPRESS
NOCACHE;


CREATE UNIQUE INDEX ENTRIES_PK ON ENTRIES
(ENTRY_ID)
LOGGING
TABLESPACE USERS
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

ALTER TABLE ENTRIES ADD (
  CONSTRAINT ENTRIES_PK
  PRIMARY KEY
  (ENTRY_ID)
  USING INDEX ENTRIES_PK
  ENABLE VALIDATE);


ALTER TABLE ENTRIES ADD (
  FOREIGN KEY (CHANNEL_ID)
  REFERENCES CHANNELS (CHANNEL_ID)
  ENABLE VALIDATE
,  FOREIGN KEY (USER_ID)
  REFERENCES USERS (USER_ID)
  ENABLE VALIDATE);



DROP TABLE COMMENTS CASCADE CONSTRAINTS;

CREATE TABLE COMMENTS
(
  COMMENT_ID  INTEGER                           NOT NULL,
  ENTRY_ID    INTEGER                           NOT NULL,
  USER_ID     INTEGER                           NOT NULL,
  CONTENT     CLOB,
  CREATED_AT  TIMESTAMP(0)
)
LOB (CONTENT) STORE AS SECUREFILE (
  TABLESPACE  USERS
  ENABLE      STORAGE IN ROW
  CHUNK       8192
  RETENTION
  NOCACHE
  LOGGING)
TABLESPACE USERS
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
LOGGING
NOCOMPRESS
NOCACHE;


CREATE UNIQUE INDEX COMMENTS_PK ON COMMENTS
(COMMENT_ID)
LOGGING
TABLESPACE USERS
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

ALTER TABLE COMMENTS ADD (
  CONSTRAINT COMMENTS_PK
  PRIMARY KEY
  (COMMENT_ID)
  USING INDEX COMMENTS_PK
  ENABLE VALIDATE);


ALTER TABLE COMMENTS ADD (
  FOREIGN KEY (ENTRY_ID)
  REFERENCES ENTRIES (ENTRY_ID)
  ENABLE VALIDATE
,  FOREIGN KEY (USER_ID)
  REFERENCES USERS (USER_ID)
  ENABLE VALIDATE);


DROP TABLE LIKES CASCADE CONSTRAINTS;

CREATE TABLE LIKES
(
  LIKE_ID     INTEGER,
  ENTRY_ID    INTEGER,
  COMMENT_ID  INTEGER,
  USER_ID     INTEGER,
  CREATED_AT  TIMESTAMP(0)
)
TABLESPACE USERS
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
LOGGING
NOCOMPRESS
NOCACHE;


CREATE UNIQUE INDEX LIKES_PK ON LIKES
(LIKE_ID)
LOGGING
TABLESPACE USERS
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

ALTER TABLE LIKES ADD (
  CONSTRAINT LIKES_PK
  PRIMARY KEY
  (LIKE_ID)
  USING INDEX LIKES_PK
  ENABLE VALIDATE);


ALTER TABLE LIKES ADD (
  FOREIGN KEY (ENTRY_ID)
  REFERENCES ENTRIES (ENTRY_ID)
  ENABLE VALIDATE
,  FOREIGN KEY (COMMENT_ID)
  REFERENCES COMMENTS (COMMENT_ID)
  ENABLE VALIDATE
,  FOREIGN KEY (USER_ID)
  REFERENCES USERS (USER_ID)
  ENABLE VALIDATE);


DROP TABLE REPORTS CASCADE CONSTRAINTS;

CREATE TABLE REPORTS
(
  REPORT_ID   INTEGER                           NOT NULL,
  USER_ID     INTEGER                           NOT NULL,
  ENTRY_ID    INTEGER                           NOT NULL,
  COMMENT_ID  INTEGER                           NOT NULL,
  REASON      CLOB,
  CREATED_AT  TIMESTAMP(0),
  STATUS      VARCHAR2(50 CHAR)
)
LOB (REASON) STORE AS SECUREFILE (
  TABLESPACE  USERS
  ENABLE      STORAGE IN ROW
  CHUNK       8192
  RETENTION
  NOCACHE
  LOGGING)
TABLESPACE USERS
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
LOGGING
NOCOMPRESS
NOCACHE;


CREATE UNIQUE INDEX REPORTS_PK ON REPORTS
(REPORT_ID)
LOGGING
TABLESPACE USERS
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

ALTER TABLE REPORTS ADD (
  CONSTRAINT REPORTS_PK
  PRIMARY KEY
  (REPORT_ID)
  USING INDEX REPORTS_PK
  ENABLE VALIDATE);


ALTER TABLE REPORTS ADD (
  FOREIGN KEY (USER_ID)
  REFERENCES USERS (USER_ID)
  ENABLE VALIDATE
,  FOREIGN KEY (ENTRY_ID)
  REFERENCES ENTRIES (ENTRY_ID)
  ENABLE VALIDATE
,  FOREIGN KEY (COMMENT_ID)
  REFERENCES COMMENTS (COMMENT_ID)
  ENABLE VALIDATE);



DROP TABLE SAVED_ENTRIES CASCADE CONSTRAINTS;

CREATE TABLE SAVED_ENTRIES
(
  SAVED_ID  INTEGER                             NOT NULL,
  USER_ID   INTEGER                             NOT NULL,
  ENTRY_ID  INTEGER                             NOT NULL,
  SAVED_AT  TIMESTAMP(0)
)
TABLESPACE USERS
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
LOGGING
NOCOMPRESS
NOCACHE;


CREATE UNIQUE INDEX SAVED_ENTRIES_PK ON SAVED_ENTRIES
(SAVED_ID)
LOGGING
TABLESPACE USERS
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

ALTER TABLE SAVED_ENTRIES ADD (
  CONSTRAINT SAVED_ENTRIES_PK
  PRIMARY KEY
  (SAVED_ID)
  USING INDEX SAVED_ENTRIES_PK
  ENABLE VALIDATE);


ALTER TABLE SAVED_ENTRIES ADD (
  FOREIGN KEY (USER_ID)
  REFERENCES USERS (USER_ID)
  ENABLE VALIDATE
,  FOREIGN KEY (ENTRY_ID)
  REFERENCES ENTRIES (ENTRY_ID)
  ENABLE VALIDATE);





DROP TABLE MESSAGES CASCADE CONSTRAINTS;

CREATE TABLE MESSAGES
(
  MESSAGE_ID   INTEGER                          NOT NULL,
  SENDER_ID    INTEGER                          NOT NULL,
  RECEIVER_ID  INTEGER                          NOT NULL,
  CONTENT      CLOB                             NOT NULL,
  SENT_AT      TIMESTAMP(0),
  IS_READ      INTEGER,
  IS_SENT      INTEGER,
  READED_AT    INTEGER
)
LOB (CONTENT) STORE AS SECUREFILE (
  TABLESPACE  USERS
  ENABLE      STORAGE IN ROW
  CHUNK       8192
  RETENTION
  NOCACHE
  LOGGING)
TABLESPACE USERS
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
LOGGING
NOCOMPRESS
NOCACHE;


CREATE UNIQUE INDEX MESSAGES_PK ON MESSAGES
(MESSAGE_ID)
LOGGING
TABLESPACE USERS
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

ALTER TABLE MESSAGES ADD (
  CONSTRAINT MESSAGES_PK
  PRIMARY KEY
  (MESSAGE_ID)
  USING INDEX MESSAGES_PK
  ENABLE VALIDATE);


ALTER TABLE MESSAGES ADD (
  FOREIGN KEY (SENDER_ID)
  REFERENCES USERS (USER_ID)
  ENABLE VALIDATE
,  FOREIGN KEY (RECEIVER_ID)
  REFERENCES USERS (USER_ID)
  ENABLE VALIDATE);
